"use strict";function e(e="",o={}){let{color:n=null,style:r="color: blue; font-size: 11pt;",hideInProduction:i,startSpinner:a=!1,stopSpinner:s=!1}=o;void 0===i&&(i="undefined"!=typeof window&&(null==window?void 0:window.location.hostname.includes("localhost"))),"object"==typeof e&&(e=l(e)+"\n\n"+JSON.stringify(e,null,2)),n&&void 0!==typeof process&&(e=(t[n]||"")+e+t.reset);var d=0;return a?(global||globalThis).interval=setInterval((()=>{process.stdout.write((t[n]||"")+"\r"+"â ‹â ™â ¹â ¸â ¼â ´â ¦â §â ‡â ".split("")[d=++d%10]+" "+e+t.reset)}),50):s?(clearInterval((global||globalThis).interval),process.stdout.write("\r"+(e||"âœ” Done")+" ".repeat(e.length+20)+"\n")):"string"==typeof r?(1==r.split(" ").length||n?r=`color: ${n||r}; font-size: 11pt;`:r.match(/^#[0-9a-fA-F]{6}$/)&&(r=`color: ${r}; font-size: 11pt;`),i?console.debug((r?"%c":"")+(e||""),r):console.log((r?"%c":"")+(e||""),r)):"object"==typeof r&&console.log(e,...r),!0}Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const t={reset:"[0m",black:"[30m",red:"[31m",green:"[32m",yellow:"[33m",blue:"[34m",magenta:"[35m",cyan:"[36m",white:"[37m",gray:"[90m",brightRed:"[91m",brightGreen:"[92m",brightYellow:"[93m",brightBlue:"[94m",brightMagenta:"[95m",brightCyan:"[96m",brightWhite:"[97m",bgRed:"[41m",bgGreen:"[42m",bgYellow:"[43m",bgBlue:"[44m",bgMagenta:"[45m",bgCyan:"[46m",bgWhite:"[47m",bgGray:"[100m"};function o(e){return"string"==typeof e?t.yellow:"number"==typeof e?t.cyan:"boolean"==typeof e?t.magenta:"function"==typeof e?t.red:null===e?t.gray:Array.isArray(e)?t.blue:"object"==typeof e?t.green:t.white}function n(e){return"string"==typeof e?'""':"number"==typeof e?"number":"boolean"==typeof e?"bool":"function"==typeof e?"function":null===e?"null":Array.isArray(e)?e.length?"["+n(e[0])+"]":"[]":"object"==typeof e?"{...}":typeof e}function l(e,r=0){const i="  ".repeat(r);if("object"!=typeof e||null===e){return o(e)+n(e)+t.reset}if(Array.isArray(e)){let o=t.blue+"["+t.reset;return e.length&&(o+="\n"),e.forEach(((t,n)=>{o+=i+"  "+l(t,r+1),n<e.length-1&&(o+=","),o+="\n"})),o+=i+t.blue+"]"+t.reset,o}let a=t.green+"{"+t.reset;const s=Object.keys(e);return s.length&&(a+="\n"),s.forEach(((d,c)=>{const u=e[d],g=o(u);a+=i+"  ","object"!=typeof u||null===u||Array.isArray(u)?Array.isArray(u)?a+=g+d+t.reset+": "+l(u,r+1):a+=g+d+": "+n(u)+t.reset:a+=g+d+t.reset+": "+l(u,r+1),c<s.length-1&&(a+=","),a+="\n"})),a+=i+t.green+"}"+t.reset,a}function r(e){if("undefined"==typeof document)return;let t,o=document.getElementById("alert-overlay");o||(o=document.body.appendChild(document.createElement("div")),o.id="alert-overlay",o.setAttribute("style","position:fixed;inset:0;z-index:9999;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center"),o.innerHTML='<div id="alert-box" style="background:#fff;padding:1.5em 2em;border-radius:8px;box-shadow:0 2px 16px #0003;min-width:220px;max-height:80vh;position:relative;display:flex;flex-direction:column;">\n      <button id="close-alert" style="position:absolute;top:12px;right:20px;font-size:1.5em;background:none;border:none;cursor:pointer;color:black;">&times;</button>\n      <div id="alert-list" style="overflow:auto;flex:1;"></div>\n    </div>',o.addEventListener("click",(e=>e.target==o&&o.remove())),document.getElementById("close-alert").onclick=()=>o.remove()),t=o.querySelector("#alert-list"),t.innerHTML+=`<div style="border-bottom:1px solid #333; font-size:1.2em;margin:0.5em 0;">${e}</div>`}async function i(t,o){var n,s,d,c,u,g,f,p,b,y,m,h;let{headers:w,response:v={},method:T=(o.post?"POST":o.put?"PUT":o.patch?"PATCH":"GET"),cache:S=!1,cacheForTime:x=60,timeout:L=30,baseURL:O="undefined"!=typeof process&&process.env.SERVER_API_URL||"/api/",cancelOngoingIfNew:E=!1,cancelNewIfOngoing:A=!1,rateLimit:j=0,debug:k=!1,infiniteScroll:P=null,setDefaults:N=!1,retryAttempts:D=0,logger:q=e,onRequest:J=null,onResponse:R=null,onError:$=null,onStream:F=null,repeatEvery:I=null,repeat:C=0,debounce:H=0,regrabOnStale:M=!1,regrabOnFocus:z=!1,regrabOnNetwork:W=!1,post:U=!1,put:B=!1,patch:G=!1,body:_=null,...K}={..."undefined"!=typeof window?null==(n=null==window?void 0:window.grab)?void 0:n.defaults:(null==(d=null==(s=global||globalThis)?void 0:s.grab)?void 0:d.defaults)||{},...o},Y=e=>t.startsWith(e);Y("http:")||Y("https:")?O="":Y("/")||O.endsWith("/")?Y("/")&&O.endsWith("/")&&(t=t.slice(1)):t="/"+t;try{if(H>0)return await a((async()=>{await i(t,{...o,debounce:0})}),1e3*H);if(C>1){for(let e=0;e<C;e++)await i(t,{...o,repeat:0});return v}if(I)return setInterval((async()=>{await i(t,{...o,repeat:0,repeatEvery:null})}),1e3*I),v;if(null==o?void 0:o.setDefaults)return void("undefined"!=typeof window?window.grab.defaults={...o,setDefaults:void 0}:void 0!==(global||globalThis).grab&&((global||globalThis).grab.defaults={...o,setDefaults:void 0}));if(void 0!==typeof window){const e=async()=>await i(t,{...o,cache:!1});M&&S&&setTimeout(e,1e3*x),W&&window.addEventListener("online",e),z&&(window.addEventListener("focus",e),document.addEventListener("visibilitychange",(async()=>{"visible"===document.visibilityState&&await e()})))}let e="function"==typeof v?v:null;v&&!e||(v={});var[V,Q,X]=P||[];if((null==P?void 0:P.length)&&"undefined"==typeof window){let e="string"==typeof X?document.querySelector(X):X;e&&e.removeEventListener("scroll",null==(c=window??globalThis)?void 0:c.scrollListener),(window??globalThis).scrollListener=e.addEventListener("scroll",(async({target:e})=>{const n=e;localStorage.setItem("scroll",JSON.stringify([n.scrollTop,n.scrollLeft,X])),n.scrollHeight-n.scrollTop<=n.clientHeight+200&&await i(t,{...o,cache:!1,[V]:(null==r?void 0:r.currentPage)+1})}))}let n=JSON.stringify(V?{...K,[V]:void 0}:K),r=null==(u=null==i?void 0:i.log)?void 0:u.find((e=>e.request==n&&e.path==t));if(V){let e=(null==r?void 0:r.currentPage)+1||(null==K?void 0:K[V])||1;r||(v[Q]=[],e=1),r&&(r.currentPage=e),K[V]=e}else{for(let e of Object.keys(v))v[e]=void 0;if(S&&(!x||(null==r?void 0:r.lastFetchTime)>Date.now()-1e3*x)){for(let e of Object.keys(r.res))v[e]=r.res[e];e&&(v=e(v))}}if(e?e({isLoading:!0}):"object"==typeof v&&(v.isLoading=!0),e&&(v=e(v)),j>0&&(null==r?void 0:r.lastFetchTime)&&r.lastFetchTime>Date.now()-1e3*j)throw new Error(`Fetch rate limit exceeded for ${t}. \n        Wait ${j}s between requests.`);if(null==r?void 0:r.controller)if(E)r.controller.abort();else if(A)return{isLoading:!0};void 0!==i.log&&(null==(g=i.log)||g.unshift({path:t,request:n,lastFetchTime:Date.now(),controller:new AbortController}));let s={method:T,headers:{"Content-Type":"application/json",Accept:"application/json",...w},body:K.body,redirect:"follow",cache:S?"force-cache":"no-store",signal:E?null==(p=null==(f=i.log[0])?void 0:f.controller)?void 0:p.signal:AbortSignal.timeout(1e3*L)},d="";["POST","PUT","PATCH"].includes(T)?s.body=K.body||JSON.stringify(K):d=(Object.keys(K).length?"?":"")+new URLSearchParams(K).toString(),"function"==typeof J&&([t,v,K,s]=J(t,v,K,s));let h=null,N=new Date,D=null==(b=i.mock)?void 0:b[t],$=e=>new Promise((t=>setTimeout(t,1e3*e||0)));if(!D||D.params&&D.method!=T||D.params&&n!=JSON.stringify(D.params)){if(h=await fetch(O+t+d,s).catch((e=>{throw new Error(e)})),!h.ok)throw new Error(`HTTP error: ${h.status} ${h.statusText}`);let e=h.headers.get("content-type");F?await F(h.body):h=await(e?e.includes("application/json")?h&&h.json():e.includes("application/pdf")||e.includes("application/octet-stream")?h.blob():h.text():h.json()).catch((e=>{throw new Error("Error parsing response: "+e)}))}else await $(D.delay),h="function"==typeof D.response?D.response(K):D.response;"function"==typeof R&&([t,v,K,s]=R(t,v,K,s)),e?e({isLoading:void 0}):"object"==typeof v&&(null==v||delete v.isLoading),null==r||delete r.controller;const U=((Number(new Date)-Number(N))/1e3).toFixed(1);if(k&&q("Path:"+O+t+d+"\n"+JSON.stringify(o,null,2)+"\nTime: "+U+"s\nResponse: "+l(h)),"object"==typeof h){for(let e of Object.keys(h))v[e]=Q==e&&(null==(y=v[e])?void 0:y.length)?[...v[e],...h[e]]:h[e];void 0!==v&&(v.data=h)}else e?e({data:h,...h}):"object"==typeof v&&(v.data=h);return void 0!==i.log&&(null==(m=i.log)||m.unshift({path:t,request:JSON.stringify({...K,paginateKey:void 0}),response:v,lastFetchTime:Date.now()})),e&&(v=e(v)),v}catch(Z){let e="Error: "+Z.message+"\nPath:"+O+t+"\n";return JSON.stringify(K),"function"==typeof $&&$(Z.message,O+t,K),o.retryAttempts>0?await i(t,{...o,retryAttempts:--o.retryAttempts}):(!Z.message.includes("signal")&&o.debug&&(q(e,{color:"red"}),k&&void 0!==typeof document&&r(e)),v.error=Z.message,"function"==typeof v?(v.data=v({isLoading:void 0,error:Z.message}),v=v.data):null==v||delete v.isLoading,void 0!==i.log&&(null==(h=i.log)||h.unshift({path:t,request:JSON.stringify(K),error:Z.message})),v)}}i.instance=(e={})=>(t,o={})=>i(t,{...e,...o});const a=async(e,t)=>{let o;return async function(...n){clearTimeout(o),o=setTimeout((async()=>{clearTimeout(o),await e(...n)}),t)}};"undefined"!=typeof window?(window.log=e,window.grab=i,window.grab.log=[],window.grab.mock={},window.grab.defaults={},document.addEventListener("keydown",(e=>{if("i"===e.key&&e.ctrlKey){let e=" ";for(let t of grab.log)e+=`<div style="margin-bottom:1em; border-bottom:1px solid #ccc; padding-bottom:1em;">\n          <b>Path:</b> ${t.path}<br>\n          <b>Request:</b> ${t.request}<br>\n          <b>Response:</b> ${JSON.stringify(t.response,null,2)}<br>\n          <b>Time:</b> ${new Date(t.lastFetchTime).toLocaleString()}\n        </div>`;r(e)}})),document.addEventListener("DOMContentLoaded",(()=>{let[e,t,o]=JSON.parse(localStorage.getItem("scroll"))||[];e&&(document.querySelector(o).scrollTop=e,document.querySelector(o).scrollLeft=t)}))):"undefined"!=typeof global?(i.log=[],i.mock={},i.defaults={},global.log=e,global.grab=i.instance()):"undefined"!=typeof globalThis&&(i.log=[],i.mock={},i.defaults={},globalThis.log=e,globalThis.grab=i.instance()),exports.default=i,exports.grab=i,exports.log=e,exports.printJSONStructure=l,exports.showAlert=r;
//# sourceMappingURL=grab-api.cjs.js.map
